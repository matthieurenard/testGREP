# testGREP

VM to test [GREP](https://github.com/matthieurenard/GREP).
This VM is set up using [Vagrant](https://vagrantup.com).
To use it, you first need to install the following tools:
* Vagrant
* VirtualBox
* VirtualBox extension pack

## Installing Vagrant

To install Vagrant, use a package manager (this is not recommended since 
packages are often out of date), or go to [Vagrant download 
page](https://vagrantup.com/downloads.html) and choose the download 
corresponding to your configuration (For Ubuntu users, the Debian package should 
work).

## Installing VirtualBox and Extension Pack

VirtualBox can also be installed from repositories on certain distributions, or 
from [VirtualBox download page](https://www.virtualbox.org/wiki/Downloads).
The Extension Pack can also be found on this page.
To install the Extension Pack, first install VirtualBox and then open the 
Extenstion Pack with VirtualBox.

## Running the Virtual Machine

Once Vagrant, VirtualBox, and the Extension Pack are installed, just open a 
shell, go to the directory containing the VagrantFile of this repository 
(https://github.com/matthieurenard/testGREP) and run

```
$ vagrant up
```

This should download the Virtual Machine and launch it.
Once the VM has started (there is no graphical interface, the command line 
should just return a new prompt), issue

```
$ vagrant ssh
```

to log into the Virtual Machine.

To test GREP, go to the GREP/tests/offline directory:

```
$ cd ~/GREP/tests/offline
```

The executable *game_enf_offline* is GREP running in offline mode. Some
properties are already given in the directory (files with extension .tmtn). To
test GREP on property *propThesis.tmtn* for instance, with input (1, w)(2,
a)(3, on)(4, w)(5, off), issue:

```
$ echo (1, w)(2, a)(3, on)(4, w)(5, off) | ./game_enf_offline -a propThesis.tmtn
```

To also draw the game graph and the zone graph, one can use:

```
$ echo (1, w)(2, a)(3, on)(4, w)(5, off) | ./game_enf_offline -a propThesis.tmtn 
\
 -d gamegraph.pdf -z zonegraph.pdf
```

Since there is no graphical interface in the VM, to see the produced files, we 
need to retrieve them on the host.
To do this, simply copy or move the files to the directory /vagrant, which is 
synced with the directory of the host containing the VagrantFile:

```
$ cp gamegraph.pdf zonegraph.pdf /vagrant
```

The files should appear on the host next to the VagrantFile.
Use your favourite PDF viewer to visualise them.

# Running benchmarks

The provided VM also contains all the necessary tools necessary to run some 
benchmarks.
Note, however, that running benchmarks should not be done inside a virtual 
machine, since it can alter performance. To test performance in real condition, 
one should consider compiling GREP onto a non-virtual system.

## The benchmarks folders

There are two paths containing some benchmarks :
~/GREP/tests/offline/benchmarks_fast and ~/GREP/tests/offline/benchmarks_opti .
They correspond to testing GREP using the fast mode (that is faster but can 
output invalid sequences depending on the property under scrutiny) or using the 
standard mode (safer but can be slower), respectively.

To test the standard mode :

```
$ cd ~/GREP/tests/offline/benchmarks_opti
```

This folder contains some scripts that are used to execute the benchmarks, and 
some folders from which the scripts should be run, each representing a property 
to test. Let's assume that
we want to test the performance of GREP for the provided response property. 
Then, we first move into the corresponding directory :

```
$ cd response
```

## Generating random inputs for a property

Then, we can generate a set of random input sequences for that property using 
the `generate_inputs.sh` script :

```
$ ./generate_inputs.sh
```

This will create two files : inputs_game, that contains the random sequences in 
a format suitable for GREP, and inputs_tipex, that contains the same sequences 
in a format suitable for TiPEX.
Once the inputs are generated, we can run GREP with these inputs, computing the 
times required to output the events.

## Running GREP on the selected property

In order to avoid "time noise" generated by the environment (for instance, 
preemption
from the OS), the tool is run several times on each input. This is achieved by 
the use of the `generate_times.sh` script :

```
$ ./generate_times.sh
```

This can take some time, since the tool is usually run a certain number of times 
(often 1000) for every input sequence, that is usually 1000 events long.

## Plot the results

Once the tool has been run for each sequence, many files have been created, that 
contain different pieces of information for the execution of GREP with a 
particular input. For instance, the `times*` files contains the times for the 
different executions on one input sequence.
The times gathered in these files can be displayed as plots using the R tool :

```
$ R --vanilla < plot.r
```

This will generate two plots in the PDF format : `response_scatter_meds.pdf` and 
`response_scatter_lmeds.pdf` that plot the median values for each event of one 
execution, on a linear scale for the first file, and on a logarithmic one for 
the second one. Note that the filenames will vary depending on the property. The 
produced filenames can be seen with :

```
$ ls *.pdf
```

This will list all files whose name ends with ".pdf".
To visualise the images, retrieve them on the host by moving or copying them in 
the shared folder :

```
$ cp *.pdf /vagrant
```

The files will then be available on the host, in the directory where the 
VagrantFile resides.

